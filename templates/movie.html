{% extends "base.html" %}

{% block title %}Nutbush Movie {{ movie_name }} {% endblock %}
{% block display_title %} Movie  {% endblock %}
{% block display_title_sub %}
    {{ movie_name }}
{% endblock %}

{% block main_content %}
    <!-- Error message used by our JS -->
    <div class="row"><div class="col-md-12">
        <div class="alert fade in" id="errorFromJS" style="display:none;">
            <button type="button" class="close">Ã—</button>
            <span id="errorFromJSText"></span>
        </div>
    </div></div>

    {% if movie %}
        {% if movie.imdbid %}
        <div class="row">
            <div class="col-md-12">
                <div class="info" id="movie_query_progress" name="movie_query_progress"></div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8" id="movie-details-container">
            </div>
            <div class="col-md-4">
                <img id="det-movieimg" src="" alt="{{movie.name}}" class="img-responsive img-thumbnail"/>
            </div>
        </div>
        {% endif %}

    {% else %}
        <div class="row">
        <div class="col-md-12">

        <table class="datatable SortableTable" id="allmovies" name="allmovies">
        <thead>
            <tr><th>Movie</th></tr>
        </thead>
        <tbody>
        {% for mov in movies %}
            <tr>
                <td><a href="{{url_for('main.movie_display', moviekey=mov.imdbid)}}">{{mov.name}}</a></td>
            </tr>
        {% endfor %}
        </tbody>
        </table>

        </div>
        </div>

    {% endif %}
{% endblock %}

{% block extra_js %}
<script type="text/javascript">
$('#allmovies').dataTable({
    "bPaginate": false,
    responsive: true
});

{% if movie and movie.imdbid %}
var imdbid = "{{movie.imdbid}}";
data.movie_by_imdb(imdbid, function(all_data, textStatus) {
    if (all_data.error) {
        $("#errorFromJSText").html(all_data.error);
        $("#errorFromJS").show();
        alert(all_data.error);
        return;
    }

    <!-- TODO: perhaps show imdb and rotten tomatoes data? -->

    console.log(all_data);
    var movie_data = all_data.omdb;

    function addOne(title, disp) {
        if (disp === null) {
            disp = _.prop(movie_data, title);
        }
        if (_.isArray(disp)) {
            disp = _.join(disp, ',');
        }

        var newEle = $('<div class="row"></div>');
        newEle.append(
            $('<div class="col-md-1 data-name"></div>').text(title)
        );
        newEle.append(
            $('<div class="col-md-offset-1 col-md-10 data-value"></div>').text(disp)
        );
        $("#movie-details-container").append(newEle);
        return newEle;
    }

    img = _.prop(movie_data, "Poster");
    if (!!img) {
        $("#det-movieimg").attr("src", img);
    }

    addOne("Director", null);
    addOne('Writer', null);
    addOne("Actors", null);
    addOne('Production', null);
    addOne('Country', null);
    addOne('Language', null);
    addOne("Runtime", null);
    addOne("Genre", null);
    addOne("Year", null);
    addOne('Released', null);
    addOne('DVD', null);
    addOne('Awards', null);
    addOne('Rated', null);
    addOne('Metascore', null);
    addOne('BoxOffice', null);
    addOne("Plot", null);
});
{% endif %}
</script>
{% endblock %}
